{% extends 'index.html' %}
{% block ace-content %}
<!-- ACE Editor -->   
<link href="/static/dist/css/bootstrap-multiselect.css" rel="stylesheet">
<script src="/static/dist/js/bootstrap-multiselect.js"></script>
<script type="text/javascript" src="/static/dist/js/bootstrap-notify.js"></script>
<link href="/static/dist/css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
<script src="/static/dist/js/fileinput.js" type="text/javascript"></script>
<style type="text/css"> 
	td.details-control {
	    background: url('/static/img/details_open.png') no-repeat center center;
	    cursor: pointer;
	}
	tr.shown td.details-control {
	    background: url('/static/img/details_close.png') no-repeat center center;
	} 
</style>	
{% endblock %}
{% block page-content %}

<div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header"><i class="fa fa-file-pdf-o"></i> 配置文件管理</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <div class="row">
                <div class="col-lg-12" id="add_file_order" style="display:none;">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            	<i class="fa  fa-rss"></i> 配置文件上传
                        </div>
                        <div class="panel-body">
                            <form role="form" method="post" action="/conffile/list/" id="audit_filedownload_order" enctype="multipart/form-data">
                            <div class="col-lg-6">
								<legend>
									<i class="fa  fa-paper-plane-o"></i> 目标设备选择
								</legend>
								<div class="form-group" >
									<label><font color='red'>* </font>设备名称</label>
									<select class="form-control" name="assets_name" id="assets_name">
										<option value="" name="server_model" selected="selected">选择设备</option>
                                        {% for asset in assets %}
                                            <option value="{{ asset.id }}" name="server_model">{{ asset.hostname }}</option>
                                        {% endfor %}
									</select>
								</div>
								<div class="form-group">
								 <label class="col-sm-2 control-label">上传文件</label>
								 <div class="col-sm-6">
								 	<input type="file" id="import_file" name="import_file"  placeholder="上传excel文件" required/>
								 </div>
							     </div>
                         </div>
							<!-- /.col-lg-6 (nested) -->
							<div class="hr hr32 hr-dotted"></div>
							 <div class="col-lg-6">

								<legend>
									<i class="fa  fa-paper-plane"></i> 文件工单
								</legend>
									{% csrf_token %}
									<div class="form-group">
	 									<label><font color='red'>* </font>配置文件描述<i class="fa fa-info-circle" data-toggle="tooltip" title="说明用途"></i></label>
										<textarea class="form-control" rows="3" id="conffile_detail"></textarea>
									</div>
									<lable id="addconffile"><button type="submit" class="btn btn-default" onclick="addconffile(this)" >上传</button></lable>
									<button type="reset" class="btn btn-default">撤销</button>
                                </div>
							<!-- /.col-lg-6 (nested) -->
							 <div class="hr hr32 hr-dotted"></div>
                            </form>
							</div>
						</div>
					</div>
            </div>

            <div class="row">
                 <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            	<i class="fa  fa-paper-plane-o  "></i> 配置文件列表
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                        	<div>
                        		<button type="button" class="btn btn-xs btn-default" id="add_file_order_button"><i class="glyphicon glyphicon-plus"></i></button>
                        	</div>
							<table  width="100%" class="table table-striped table-bordered table-hover dataTable no-footer" id="taskTableList">	
						        <thead>
						            <tr>
						                <th class="text-center">详细</th>
						                <th class="text-center">ID</th>
						                <th class="text-center">设备名称</th>
						                <th class="text-center">文件名称</th>
						                <th class="text-center">描述</th>
						                <th class="text-center">上传时间</th>
										<th class="text-center">操作</th>
						            </tr>
						        </thead>
		                                <tbody>
                                        {% for file in conffile %}
                                        <tr>
		                                		<td class="text-center">
		                                		</td>
		                                		<td class="text-center">
		                                			{{file.id}}
		                                		</td>
		                                		<td class="text-center">
		                                			{{file.hostname}}
		                                		</td>
		                                		<td class="text-center">
	                                				{{file.filename}}
		                                		</td>
		                                		<td class="text-center">
                                                    {{ file.file_detail }}
                                                </td>
                                                <td class="text-center">
                                                    {{ file.date }}
                                                </td>
                                                <td>
                                                     <button  type="button" class="btn btn-default" onclick="delconffile(this,{{file.id}})"><i class="glyphicon glyphicon-trash"></i></button>
                                                </td>

                                        </tr>
                                        {% endfor %}
	                                    </tbody>
	                       	</table>

                            <!-- /.table-responsive -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
            </div>                    
</div>




<script type="text/javascript"> 
$(function(){
    $('#add_file_order_button').click(function(){//点击a标签
        if($('#add_file_order').is(':hidden')){
        	$('#add_file_order').show();
        }
        else{
        	$('#add_file_order').hide();
        }
    })
})

function addconffile(obj){
		var btnObj = $(obj);
		btnObj.attr('disabled',true);
		var serverId = [];
	    var url = "/conffile/list/";
	    var assets_name =document.getElementById("assets_name").value
        var conffile_detail =document.getElementById("conffile_detail").value
        var form_data = new FormData();
        var import_file =$( '#import_file')[0].files[0];
        form_data.append('op','add');
        form_data.append('assets_name',assets_name);
        form_data.append('conffile_detail',conffile_detail);
        form_data.append('import_file',import_file);
            //if(file_info==undefined)暂且不许要判断是否有附件
                //alert('你没有选择任何文件');
                //return false
            $.ajax({
                url: url,
                type: 'POST',
                data: form_data,
                processData: false,  // tell jquery not to process the data
                contentType: false, // tell jquery not to set contentType
                success: function (callback) {

                   btnObj.removeAttr('disabled');
                   window.wxc.xcConfirm("上传成功！", window.wxc.xcConfirm.typeEnum.success);
                },
                 error:function(response){
		            	btnObj.removeAttr('disabled');
		            	window.wxc.xcConfirm("上传失败！", window.wxc.xcConfirm.typeEnum.error);
		              }

            });
}

function delconffile(obj,id){
		var txt=  "是否确认删除？";
		var btnObj = $(obj);
		btnObj.attr('disabled',true);
		var option = {
			title: "删除当前文件",
			btn: parseInt("0011",2),
			onOk: function(){
				$.ajax({
					  dataType: "JSON",
			          type:"POST",  //提交类似
					  url: '/conffile/list/',
                      data:{'op':'del','file_id':id},
				      success:function(response){
				    	btnObj.removeAttr('disabled');
			            window.wxc.xcConfirm("删除成功", window.wxc.xcConfirm.typeEnum.success);
			            location.reload();
				      },
		              error:function(response){
		            	btnObj.removeAttr('disabled');
		            	window.wxc.xcConfirm("删除失败！", window.wxc.xcConfirm.typeEnum.error);
		              }
					});
			},
			onCancel:function(){
			},
			onClose:function(){
			}
		}
		window.wxc.xcConfirm(txt, "custom", option);
	}

$(document).ready(function() {
    $('#ansible_server').multiselect({
        enableClickableOptGroups: true,
        enableCollapsibleOptGroups: true,
        includeSelectAllOption: true,
       	enableFiltering: true,            
    });
});












	 


	
		
	
</script>
{% endblock %}
